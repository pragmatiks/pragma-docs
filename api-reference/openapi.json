{
  "openapi": "3.1.0",
  "info": {
    "title": "Pragma API",
    "version": "0.1.0"
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health",
        "description": "Health check endpoint for load balancers and monitoring.\n\nReturns:\n    Status dictionary indicating service availability.",
        "operationId": "health",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "type": "object",
                  "title": "Response Health"
                }
              }
            }
          }
        }
      }
    },
    "/auth/me": {
      "get": {
        "tags": [
          "auth"
        ],
        "summary": "Get Current User Info",
        "description": "Return current authenticated user information.\n\nReturns:\n    UserInfo with user ID, email, organization ID and name.\n\nRaises:\n    HTTPException: 500 if unable to fetch user information.",
        "operationId": "auth-get_current_user_info",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserInfo"
                }
              }
            }
          }
        }
      }
    },
    "/ops/dead-letter": {
      "get": {
        "tags": [
          "ops"
        ],
        "summary": "List Dead Letter Events",
        "description": "List all failed events for the authenticated tenant.\n\nReturns events that failed processing after exhausting retries.\nUse this endpoint to investigate failures and retry or delete events.\n\nReturns:\n    List of failed events, optionally filtered by provider.",
        "operationId": "ops-list_dead_letter_events",
        "parameters": [
          {
            "name": "provider",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by provider name",
              "title": "Provider"
            },
            "description": "Filter by provider name"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DeadLetterEventResponse"
                  },
                  "title": "Response Ops-List Dead Letter Events"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "ops"
        ],
        "summary": "Bulk Delete Dead Letter Events",
        "description": "Bulk delete failed events.\n\nRequires either `?all=true` to delete all events or `?provider=x` to delete\nevents for a specific provider.\n\nReturns:\n    Dictionary with count of deleted events.\n\nRaises:\n    HTTPException: 400 if neither `all=true` nor `provider` specified.",
        "operationId": "ops-bulk_delete_dead_letter_events",
        "parameters": [
          {
            "name": "all",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "boolean"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Delete all events",
              "title": "All"
            },
            "description": "Delete all events"
          },
          {
            "name": "provider",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Delete events for specific provider",
              "title": "Provider"
            },
            "description": "Delete events for specific provider"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "integer"
                  },
                  "title": "Response Ops-Bulk Delete Dead Letter Events"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ops/dead-letter/{event_id}": {
      "get": {
        "tags": [
          "ops"
        ],
        "summary": "Get Dead Letter Event",
        "description": "Get a single failed event by ID.\n\nReturns:\n    Failed event with error details and original payload.\n\nRaises:\n    HTTPException: 404 if event not found.",
        "operationId": "ops-get_dead_letter_event",
        "parameters": [
          {
            "name": "event_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Event Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeadLetterEventResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "ops"
        ],
        "summary": "Delete Dead Letter Event",
        "description": "Delete a single failed event.\n\nPermanently removes the event. Idempotent - succeeds even if event doesn't exist.",
        "operationId": "ops-delete_dead_letter_event",
        "parameters": [
          {
            "name": "event_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Event Id"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Successful Response"
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ops/dead-letter/{event_id}/retry": {
      "post": {
        "tags": [
          "ops"
        ],
        "summary": "Retry Dead Letter Event",
        "description": "Retry a single failed event.\n\nRequeues the event for processing and removes it from the failed events list.\nThe event will be processed automatically.\n\nReturns:\n    Event queued for processing.\n\nRaises:\n    HTTPException: 404 if event not found.",
        "operationId": "ops-retry_dead_letter_event",
        "parameters": [
          {
            "name": "event_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Event Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OutboxEventResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ops/dead-letter/retry-all": {
      "post": {
        "tags": [
          "ops"
        ],
        "summary": "Retry All Dead Letter Events",
        "description": "Retry all failed events for the authenticated tenant.\n\nRequeues all failed events for processing and removes them from the\nfailed events list. Events will be processed automatically.\n\nReturns:\n    Dictionary with count of retried events.",
        "operationId": "ops-retry_all_dead_letter_events",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "integer"
                  },
                  "type": "object",
                  "title": "Response Ops-Retry All Dead Letter Events"
                }
              }
            }
          }
        }
      }
    },
    "/providers/": {
      "get": {
        "tags": [
          "providers"
        ],
        "summary": "List Providers",
        "description": "List all providers for the current tenant.\n\nReturns providers with their deployment status. Providers that have\nbeen pushed but not deployed will have deployment_status=None.\n\nArgs:\n    service: Provider service for provider operations.\n\nReturns:\n    List of ProviderInfo with provider metadata and deployment status.",
        "operationId": "providers-list_providers",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/ProviderInfo"
                  },
                  "type": "array",
                  "title": "Response Providers-List Providers"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/push": {
      "post": {
        "tags": [
          "providers"
        ],
        "summary": "Push Provider",
        "description": "Push provider code and trigger a Cloud Build.\n\nAccepts a tarball containing provider code and triggers a Cloud Build\nto create a container image. Returns a CalVer version for tracking.\n\nArgs:\n    provider_id: Unique identifier for the provider.\n    code: Tarball (tar.gz) containing provider source code.\n    service: Provider service for build orchestration.\n\nReturns:\n    PushResponse with CalVer version and Cloud Build ID for tracking.\n\nRaises:\n    HTTPException: 400 if build creation fails.",
        "operationId": "providers-push_provider",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_providers-push_provider"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PushResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/builds/{version}": {
      "get": {
        "tags": [
          "providers"
        ],
        "summary": "Get Build Status",
        "description": "Get the status of a build by version.\n\nArgs:\n    provider_id: Provider identifier.\n    version: CalVer version string (YYYYMMDD.HHMMSS).\n    service: Provider service for build operations.\n\nReturns:\n    BuildInfo with current build state.\n\nRaises:\n    HTTPException: 404 if build not found.",
        "operationId": "providers-get_build_status",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          },
          {
            "name": "version",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Version"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BuildInfo"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/builds/{version}/logs": {
      "get": {
        "tags": [
          "providers"
        ],
        "summary": "Get Build Logs",
        "description": "Stream logs from a build.\n\nReturns build logs as a streaming text response for real-time\nmonitoring of build progress.\n\nArgs:\n    provider_id: Provider identifier.\n    version: CalVer version string (YYYYMMDD.HHMMSS).\n    service: Provider service for build operations.\n\nReturns:\n    StreamingResponse with build logs.\n\nRaises:\n    HTTPException: 404 if build not found, 500 if streaming fails.",
        "operationId": "providers-get_build_logs",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          },
          {
            "name": "version",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Version"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/deployment": {
      "get": {
        "tags": [
          "providers"
        ],
        "summary": "Get Deployment Status",
        "description": "Get the deployment status for a provider.\n\nReturns a minimal status without internal K8s details like replica\ncounts, deployment names, or container images.\n\nArgs:\n    provider_id: Unique identifier for the provider.\n    service: Provider service for deployment operations.\n\nReturns:\n    ProviderStatus with status, version, updated_at, and healthy flag.\n\nRaises:\n    HTTPException: 404 if deployment not found.",
        "operationId": "providers-get_deployment_status",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderStatus"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/deploy": {
      "post": {
        "tags": [
          "providers"
        ],
        "summary": "Deploy Provider",
        "description": "Deploy a provider by version.\n\nDeploys the specified version or the latest successful build if no version\nis provided. Activates resource schemas from the build during deployment.\n\nArgs:\n    provider_id: Unique identifier for the provider.\n    request: Deploy request with optional version (defaults to latest successful).\n    service: Provider service for deployment orchestration.\n\nReturns:\n    ProviderStatus with status, version, updated_at, and healthy flag.\n\nRaises:\n    HTTPException: 404 if build not found or no successful build exists.\n    HTTPException: 400 if specified build is not deployable.\n    HTTPException: 500 if deployment fails.",
        "operationId": "providers-deploy_provider",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeployRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderStatus"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/builds": {
      "get": {
        "tags": [
          "providers"
        ],
        "summary": "List Builds",
        "description": "List builds for a provider.\n\nReturns the last 10 builds ordered by creation time (newest first).\nExcludes internal fields (image URL, cloud build ID).\n\nArgs:\n    provider_id: Unique identifier for the provider.\n    service: Provider service for build operations.\n\nReturns:\n    List of BuildInfo for the provider's builds.",
        "operationId": "providers-list_builds",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/BuildInfo"
                  },
                  "title": "Response Providers-List Builds"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}/versions/{version}": {
      "get": {
        "tags": [
          "providers"
        ],
        "summary": "Get Build By Version",
        "description": "Get a specific build by CalVer version.\n\nSyncs build status from Cloud Build and returns the build info.\n\nArgs:\n    provider_id: Unique identifier for the provider.\n    version: CalVer version string (YYYYMMDD.HHMMSS).\n    service: Provider service for build operations.\n\nReturns:\n    BuildInfo for the requested build.\n\nRaises:\n    HTTPException: 404 if build not found.",
        "operationId": "providers-get_build_by_version",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          },
          {
            "name": "version",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Version"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BuildInfo"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/providers/{provider_id}": {
      "delete": {
        "tags": [
          "providers"
        ],
        "summary": "Delete Provider",
        "description": "Delete a provider and all associated data.\n\nRemoves the provider deployment, resource definitions, and pending events.\nBy default, fails if the provider has any resources.\nUse cascade=true to delete all resources along with the provider.\n\nArgs:\n    provider_id: Unique identifier for the provider to delete.\n    service: Provider service for deletion orchestration.\n    cascade: If true, delete all resources. If false (default), fail if resources exist.\n\nReturns:\n    ProviderDeleteResult with cleanup summary.\n\nRaises:\n    HTTPException: 409 if provider has resources and cascade=false.\n    HTTPException: 500 if deletion fails.",
        "operationId": "providers-delete_provider",
        "parameters": [
          {
            "name": "provider_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Provider Id"
            }
          },
          {
            "name": "cascade",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "Delete all resources for this provider (default: fail if resources exist)",
              "default": false,
              "title": "Cascade"
            },
            "description": "Delete all resources for this provider (default: fail if resources exist)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderDeleteResult"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/resources/types": {
      "get": {
        "tags": [
          "resources"
        ],
        "summary": "List Resource Types",
        "description": "List available resource types.\n\nReturns resource types that have been registered by deployed providers.\nUse this to discover what resource types are available to create.\n\nReturns:\n    List of resource types, ordered by provider and resource name.",
        "operationId": "resources-list_resource_types",
        "parameters": [
          {
            "name": "provider",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by provider name",
              "title": "Provider"
            },
            "description": "Filter by provider name"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ResourceDefinition"
                  },
                  "title": "Response Resources-List Resource Types"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/resources/": {
      "get": {
        "tags": [
          "resources"
        ],
        "summary": "List Resources",
        "description": "List all resources.\n\nReturns:\n    List of resources matching filters, ordered by name.",
        "operationId": "resources-list_resources",
        "parameters": [
          {
            "name": "provider",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by provider name",
              "title": "Provider"
            },
            "description": "Filter by provider name"
          },
          {
            "name": "resource",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by resource type",
              "title": "Resource"
            },
            "description": "Filter by resource type"
          },
          {
            "name": "tags",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by tags (all must match)",
              "title": "Tags"
            },
            "description": "Filter by tags (all must match)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Resource"
                  },
                  "title": "Response Resources-List Resources"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/resources/{resource_id}": {
      "get": {
        "tags": [
          "resources"
        ],
        "summary": "Get Resource",
        "description": "Get resource by ID.\n\nReturns:\n    Resource with complete configuration and state.\n\nRaises:\n    HTTPException: 404 if resource not found.",
        "operationId": "resources-get_resource",
        "parameters": [
          {
            "name": "resource_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Resource Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "resources"
        ],
        "summary": "Delete Resource",
        "description": "Delete a resource.\n\nTriggers the provider's deletion handler. The resource is set to PENDING state\nand will be removed when the provider confirms successful deletion.\n\nIdempotent: Returns 204 if resource doesn't exist (already deleted).\n\nReturns:\n    Resource in PENDING state awaiting provider deletion.\n\nRaises:\n    HTTPException: 204 if resource not found (already deleted).\n        409 if resource is currently being processed.",
        "operationId": "resources-delete_resource",
        "parameters": [
          {
            "name": "resource_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Resource Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/resources/{resource_id}/status": {
      "get": {
        "tags": [
          "resources"
        ],
        "summary": "Get Resource Status",
        "description": "Get resource lifecycle status.\n\nReturns only the lifecycle state, useful for polling without fetching full configuration.\n\nLifecycle states:\n    - draft: Stored but not submitted for processing\n    - pending: Validated and queued for provider\n    - processing: Provider is actively processing\n    - ready: Successfully provisioned and operational\n    - failed: Processing failed (check error field)\n\nReturns:\n    ResourceStatus with lifecycle_state and optional error message.\n\nRaises:\n    HTTPException: 404 if resource not found.",
        "operationId": "resources-get_resource_status",
        "parameters": [
          {
            "name": "resource_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Resource Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResourceStatus"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/resources/apply": {
      "post": {
        "tags": [
          "resources"
        ],
        "summary": "Apply Resource",
        "description": "Apply a resource with declarative lifecycle semantics.\n\nSet lifecycle_state in the resource:\n    - lifecycle_state=\"draft\": Store without processing (default)\n    - lifecycle_state=\"pending\": Validate dependencies and queue for processing\n\nCannot set PROCESSING, READY, FAILED (system-only states).\nCannot modify resources in PENDING or PROCESSING state.\n\nReturns:\n    Applied resource with timestamps and server-populated fields.\n\nRaises:\n    HTTPException: 409 if lifecycle transition invalid or resource in processing.\n        422 if dependency validation or field reference resolution fails.",
        "operationId": "resources-apply_resource",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Resource"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Body_providers-push_provider": {
        "properties": {
          "code": {
            "type": "string",
            "format": "binary",
            "title": "Code"
          }
        },
        "type": "object",
        "required": [
          "code"
        ],
        "title": "Body_providers-push_provider"
      },
      "BuildInfo": {
        "properties": {
          "provider_id": {
            "type": "string",
            "title": "Provider Id"
          },
          "version": {
            "type": "string",
            "title": "Version"
          },
          "status": {
            "$ref": "#/components/schemas/BuildStatus"
          },
          "error_message": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error Message"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          }
        },
        "type": "object",
        "required": [
          "provider_id",
          "version",
          "status",
          "created_at"
        ],
        "title": "BuildInfo",
        "description": "Build information exposed via API.\n\nExcludes internal fields (image, cloud_build_id) that should not\nbe exposed to users."
      },
      "BuildStatus": {
        "type": "string",
        "enum": [
          "pending",
          "building",
          "success",
          "failed"
        ],
        "title": "BuildStatus",
        "description": "Status of a BuildKit build job."
      },
      "DeadLetterEventResponse": {
        "properties": {
          "event_id": {
            "type": "string",
            "title": "Event Id"
          },
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "resource_type": {
            "type": "string",
            "title": "Resource Type"
          },
          "resource_name": {
            "type": "string",
            "title": "Resource Name"
          },
          "event_type": {
            "$ref": "#/components/schemas/EventType"
          },
          "payload": {
            "additionalProperties": true,
            "type": "object",
            "title": "Payload"
          },
          "error_message": {
            "type": "string",
            "title": "Error Message"
          },
          "attempt_count": {
            "type": "integer",
            "title": "Attempt Count"
          },
          "failed_at": {
            "type": "string",
            "format": "date-time",
            "title": "Failed At"
          }
        },
        "type": "object",
        "required": [
          "event_id",
          "provider",
          "resource_type",
          "resource_name",
          "event_type",
          "payload",
          "error_message",
          "attempt_count",
          "failed_at"
        ],
        "title": "DeadLetterEventResponse",
        "description": "Failed event response.\n\nAttributes:\n    event_id: Original event ID.\n    provider: Provider name (e.g., \"postgres\").\n    resource_type: Resource type (e.g., \"database\").\n    resource_name: Resource name from manifest.\n    event_type: Type of lifecycle event (CREATE, UPDATE, DELETE).\n    payload: Resource configuration as JSON object.\n    error_message: Error message from last failed attempt.\n    attempt_count: Number of processing attempts before failure.\n    failed_at: When event failed."
      },
      "DeployRequest": {
        "properties": {
          "version": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Version"
          }
        },
        "type": "object",
        "title": "DeployRequest",
        "description": "Request to deploy a provider.\n\nIf version is omitted, deploys the latest successful build."
      },
      "DeploymentStatus": {
        "type": "string",
        "enum": [
          "pending",
          "progressing",
          "available",
          "failed"
        ],
        "title": "DeploymentStatus",
        "description": "Status of a provider deployment."
      },
      "EventType": {
        "type": "string",
        "enum": [
          "CREATE",
          "UPDATE",
          "DELETE"
        ],
        "title": "EventType",
        "description": "Resource lifecycle event type: CREATE, UPDATE, or DELETE."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "LifecycleState": {
        "type": "string",
        "enum": [
          "draft",
          "pending",
          "processing",
          "ready",
          "failed"
        ],
        "title": "LifecycleState",
        "description": "Resource lifecycle states: DRAFT, PENDING, PROCESSING, READY, FAILED."
      },
      "OutboxEventResponse": {
        "properties": {
          "event_id": {
            "type": "string",
            "title": "Event Id"
          },
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "resource_type": {
            "type": "string",
            "title": "Resource Type"
          },
          "resource_name": {
            "type": "string",
            "title": "Resource Name"
          },
          "event_type": {
            "$ref": "#/components/schemas/EventType"
          },
          "payload": {
            "additionalProperties": true,
            "type": "object",
            "title": "Payload"
          },
          "previous_config": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Previous Config"
          },
          "correlation_id": {
            "type": "string",
            "title": "Correlation Id"
          },
          "status": {
            "$ref": "#/components/schemas/OutboxStatus",
            "default": "pending"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "published_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Published At"
          }
        },
        "type": "object",
        "required": [
          "event_id",
          "provider",
          "resource_type",
          "resource_name",
          "event_type",
          "payload",
          "correlation_id",
          "created_at"
        ],
        "title": "OutboxEventResponse",
        "description": "Event response.\n\nAttributes:\n    event_id: Unique identifier for this event.\n    provider: Provider name (e.g., \"postgres\").\n    resource_type: Resource type (e.g., \"database\").\n    resource_name: Resource name from manifest.\n    event_type: Type of lifecycle event (CREATE, UPDATE, DELETE).\n    payload: Resource configuration as JSON object.\n    previous_config: Previous configuration for UPDATE events.\n    correlation_id: Correlation ID for tracing.\n    status: Processing status (pending, published).\n    created_at: When event was created.\n    published_at: When event was processed."
      },
      "OutboxStatus": {
        "type": "string",
        "enum": [
          "pending",
          "published"
        ],
        "title": "OutboxStatus",
        "description": "Status of an event.\n\nAttributes:\n    PENDING: Event created but not yet processed.\n    PUBLISHED: Event successfully processed."
      },
      "OwnerReference": {
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At"
          },
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "resource": {
            "type": "string",
            "title": "Resource"
          },
          "name": {
            "type": "string",
            "title": "Name"
          }
        },
        "type": "object",
        "required": [
          "provider",
          "resource",
          "name"
        ],
        "title": "OwnerReference",
        "description": "Reference to a resource that owns this resource for lifecycle coordination.\n\nUsed for cascading deletes and ownership tracking. When an owner resource\nis deleted, owned resources can be automatically cleaned up.\n\nA resource can have multiple owners (rare but valid for shared resources).\n\nAttributes:\n    provider: Provider that manages the owner resource.\n    resource: Resource type name.\n    name: Resource instance name."
      },
      "ProviderDeleteResult": {
        "properties": {
          "provider_id": {
            "type": "string",
            "title": "Provider Id"
          },
          "deployment_deleted": {
            "type": "boolean",
            "title": "Deployment Deleted",
            "default": false
          },
          "resources_deleted": {
            "type": "integer",
            "title": "Resources Deleted",
            "default": 0
          }
        },
        "type": "object",
        "required": [
          "provider_id"
        ],
        "title": "ProviderDeleteResult",
        "description": "User-facing result of a provider delete operation.\n\nMinimal representation without internal infrastructure details.\n\nAttributes:\n    provider_id: Provider that was deleted.\n    deployment_deleted: Whether the running deployment was removed.\n    resources_deleted: Number of resources deleted (if cascade was used)."
      },
      "ProviderInfo": {
        "properties": {
          "provider_id": {
            "type": "string",
            "title": "Provider Id"
          },
          "current_version": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Current Version"
          },
          "deployment_status": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/DeploymentStatus"
              },
              {
                "type": "null"
              }
            ]
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Updated At"
          }
        },
        "type": "object",
        "required": [
          "provider_id"
        ],
        "title": "ProviderInfo",
        "description": "Provider information exposed via API.\n\nCombines provider metadata with deployment status for listing.\n\nAttributes:\n    provider_id: Unique identifier for the provider.\n    current_version: CalVer of currently deployed build (None if never deployed).\n    deployment_status: Current deployment status (None if not deployed).\n    updated_at: Timestamp of last provider update (typically last deployment)."
      },
      "ProviderStatus": {
        "properties": {
          "status": {
            "$ref": "#/components/schemas/DeploymentStatus"
          },
          "version": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Version"
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Updated At"
          },
          "healthy": {
            "type": "boolean",
            "title": "Healthy",
            "default": false
          }
        },
        "type": "object",
        "required": [
          "status"
        ],
        "title": "ProviderStatus",
        "description": "User-facing provider deployment status.\n\nMinimal representation without internal K8s details like replica\ncounts, deployment names, or container images.\n\nAttributes:\n    status: Current deployment status.\n    version: CalVer version string of deployed build.\n    updated_at: Last update timestamp.\n    healthy: Whether the provider is healthy (available with ready replicas)."
      },
      "PushResponse": {
        "properties": {
          "version": {
            "type": "string",
            "title": "Version"
          },
          "status": {
            "$ref": "#/components/schemas/BuildStatus"
          },
          "message": {
            "type": "string",
            "title": "Message"
          }
        },
        "type": "object",
        "required": [
          "version",
          "status",
          "message"
        ],
        "title": "PushResponse",
        "description": "Response from pushing provider code."
      },
      "Resource": {
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At"
          },
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "resource": {
            "type": "string",
            "title": "Resource"
          },
          "name": {
            "type": "string",
            "title": "Name"
          },
          "config": {
            "additionalProperties": true,
            "type": "object",
            "title": "Config",
            "default": {}
          },
          "dependencies": {
            "items": {
              "$ref": "#/components/schemas/ResourceReference"
            },
            "type": "array",
            "title": "Dependencies",
            "default": []
          },
          "owner_references": {
            "items": {
              "$ref": "#/components/schemas/OwnerReference"
            },
            "type": "array",
            "title": "Owner References",
            "default": []
          },
          "outputs": {
            "additionalProperties": true,
            "type": "object",
            "title": "Outputs",
            "default": {}
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error"
          },
          "lifecycle_state": {
            "$ref": "#/components/schemas/LifecycleState",
            "default": "draft"
          },
          "pending_event_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Pending Event Id"
          },
          "tags": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Tags"
          }
        },
        "type": "object",
        "required": [
          "provider",
          "resource",
          "name"
        ],
        "title": "Resource",
        "description": "Domain model for resources with provider/resource identity and 5-state lifecycle.\n\nIdentity fields (frozen - immutable after creation):\n    provider: Provider that manages this resource type.\n    resource: Resource type name.\n    name: Unique resource instance name.\n\nConfiguration fields (mutable):\n    config: Resource configuration dictionary. May contain embedded resource\n        configurations if the provider schema defines fields as resource types.\n    dependencies: References to resources this resource depends on.\n    owner_references: References to resources that own this resource for\n        lifecycle coordination and cascading deletes.\n\nOutput fields (provider-managed):\n    outputs: Resource outputs from provider processing.\n    error: Error message when resource is in FAILED state.\n\nLifecycle fields (system-managed):\n    lifecycle_state: Current state (DRAFT/PENDING/PROCESSING/READY/FAILED).\n    pending_event_id: Event ID currently being processed (set on PROCESSING,\n        cleared on READY/FAILED). Used for response idempotency validation.\n\nCategorization fields (mutable):\n    tags: Optional list of tags for categorization and filtering.\n\nInherited from PragmaModel:\n    created_at: Creation timestamp (frozen).\n    updated_at: Last update timestamp (mutable)."
      },
      "ResourceDefinition": {
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At"
          },
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "resource": {
            "type": "string",
            "title": "Resource"
          },
          "schema": {
            "additionalProperties": true,
            "type": "object",
            "title": "Schema",
            "default": {}
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description"
          },
          "tags": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Tags"
          }
        },
        "type": "object",
        "required": [
          "provider",
          "resource"
        ],
        "title": "ResourceDefinition",
        "description": "Domain model for resource definitions with provider/resource identity.\n\nResource definitions describe the schema and configuration for a resource type.\nProviders register resource definitions to declare what resources they can manage.\n\nIdentity fields (frozen - immutable after creation):\n    provider: Provider that manages this resource type.\n    resource: Resource type name.\n\nSchema fields (mutable):\n    schema: JSON schema defining the resource configuration structure.\n    description: Human-readable description of the resource type.\n\nCategorization fields (mutable):\n    tags: Optional list of tags for categorization and filtering.\n\nInherited from PragmaModel:\n    created_at: Creation timestamp (frozen).\n    updated_at: Last update timestamp (mutable)."
      },
      "ResourceReference": {
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At"
          },
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "resource": {
            "type": "string",
            "title": "Resource"
          },
          "name": {
            "type": "string",
            "title": "Name"
          }
        },
        "type": "object",
        "required": [
          "provider",
          "resource",
          "name"
        ],
        "title": "ResourceReference",
        "description": "Reference to another resource for dependency tracking.\n\nUsed to express dependencies between resources. At commit time,\nthe API validates that all referenced resources exist and are READY.\n\nAttributes:\n    provider: Provider that manages the referenced resource.\n    resource: Resource type name.\n    name: Resource instance name."
      },
      "ResourceStatus": {
        "properties": {
          "resource_id": {
            "type": "string",
            "title": "Resource Id"
          },
          "lifecycle_state": {
            "$ref": "#/components/schemas/LifecycleState"
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error"
          }
        },
        "type": "object",
        "required": [
          "resource_id",
          "lifecycle_state"
        ],
        "title": "ResourceStatus",
        "description": "Resource lifecycle status response.\n\nAttributes:\n    resource_id: Unique resource identifier.\n    lifecycle_state: Current lifecycle state (draft, pending, processing, ready, failed).\n    error: Error message if resource is in failed state."
      },
      "UserInfo": {
        "properties": {
          "user_id": {
            "type": "string",
            "title": "User Id"
          },
          "email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Email"
          },
          "organization_id": {
            "type": "string",
            "title": "Organization Id"
          },
          "organization_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Organization Name"
          }
        },
        "type": "object",
        "required": [
          "user_id",
          "email",
          "organization_id",
          "organization_name"
        ],
        "title": "UserInfo",
        "description": "User information response model.\n\nAttributes:\n    user_id: Unique user identifier.\n    email: User's primary email address.\n    organization_id: Organization identifier.\n    organization_name: Name of the user's organization."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    }
  }
}